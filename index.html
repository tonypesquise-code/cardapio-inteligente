<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card√°pio Inteligente</title>
    <style>
        :root {
            --primary-purple: #5e35b1; 
            --dark-purple: #311b92;    
            --light-purple: #ede7f6;   
            --text-dark: #333333;
            --text-light: #777777;
            --white: #ffffff;
            --whatsapp-green: #25d366;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; }
        body { background-color: #f8f9fa; color: var(--text-dark); padding-bottom: 80px; }

        header {
            background: linear-gradient(135deg, var(--dark-purple), var(--primary-purple));
            color: var(--white); padding: 30px 20px; text-align: center;
            border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        header h1 { font-size: 1.5rem; margin-bottom: 5px; }
        header p { font-size: 0.9rem; opacity: 0.9; font-style: italic; }

        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .section-title { color: var(--dark-purple); font-size: 1.2rem; margin-bottom: 15px; }

        /* --- NOVO: Estilo das Categorias --- */
        .categories-container {
            display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 20px;
            scrollbar-width: none; /* Esconde barra de rolagem no Firefox */
        }
        .categories-container::-webkit-scrollbar { display: none; } /* Esconde barra no Chrome */
        
        .category-btn {
            background-color: var(--white); color: var(--text-dark);
            border: 1px solid #ddd; padding: 8px 16px; border-radius: 20px;
            white-space: nowrap; cursor: pointer; font-weight: bold; transition: 0.3s;
        }
        .category-btn.active {
            background-color: var(--primary-purple); color: var(--white); border-color: var(--primary-purple);
        }
        /* ----------------------------------- */

        .product-card {
            background-color: var(--white); border-radius: 12px; display: flex; overflow: hidden;
            margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 4px solid var(--primary-purple);
        }
        /* Ajuste para imagens ficarem perfeitas */
        .product-img { width: 110px; background-color: var(--light-purple); display: flex; align-items: center; justify-content: center; font-size: 3rem; padding: 0; }
        .product-img img { width: 100%; height: 100%; object-fit: cover; }
        
        .product-info { padding: 12px; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .product-title { font-size: 1.1rem; font-weight: bold; color: var(--dark-purple); margin-bottom: 4px; }
        .product-desc { font-size: 0.8rem; color: var(--text-light); line-height: 1.3; margin-bottom: 8px; }
        .product-footer { display: flex; justify-content: space-between; align-items: center; }
        .product-price { font-weight: bold; color: var(--primary-purple); font-size: 1.1rem; }
        
        .add-btn { background-color: var(--light-purple); color: var(--primary-purple); border: none; border-radius: 50%; width: 32px; height: 32px; font-size: 1.2rem; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        
        .floating-cart { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; background-color: var(--whatsapp-green); color: var(--white); border: none; border-radius: 30px; padding: 15px 20px; font-size: 1rem; font-weight: bold; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4); cursor: pointer; z-index: 1000; }
    </style>
</head>
<body>

    <header>
        <h1 id="nome-loja">Carregando...</h1>
        <p id="slogan-loja"></p>
    </header>

    <div class="container">
        <div class="categories-container" id="filtros-categoria"></div>

        <h2 class="section-title" id="titulo-secao">Todos os Pratos</h2>
        <div id="vitrine-produtos"></div>
    </div>

    <button class="floating-cart" onclick="fecharPedido()">
        <span id="texto-carrinho">üõí Sacola Vazia</span>
        <span id="total-carrinho">R$ 0,00</span>
    </button>

    <script src="dados.js"></script>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const lojaId = urlParams.get('loja') || 'cantina'; 
        const lojaAtual = restaurantes.find(r => r.id === lojaId);
        
        let carrinho = [];
        let total = 0;
        const formatarMoeda = (valor) => valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

        if (lojaAtual) {
            document.getElementById('nome-loja').innerText = lojaAtual.nome;
            document.getElementById('slogan-loja').innerText = lojaAtual.slogan;

            // --- NOVO: L√≥gica das Categorias ---
            // Pega todas as categorias sem repetir e adiciona "Todos" no come√ßo
            const categoriasUnicas = ["Todos", ...new Set(lojaAtual.cardapio.map(prato => prato.categoria))];
            const containerFiltros = document.getElementById('filtros-categoria');

            // Cria os bot√µes na tela
            categoriasUnicas.forEach(cat => {
                const btn = document.createElement('button');
                // O bot√£o "Todos" j√° come√ßa ativado (roxo)
                btn.className = 'category-btn' + (cat === 'Todos' ? ' active' : '');
                btn.innerText = cat;
                btn.onclick = () => filtrarCardapio(cat, btn);
                containerFiltros.appendChild(btn);
            });

            // Motor de filtrar
            function filtrarCardapio(categoriaSelecionada, botaoClicado) {
                // Remove a cor roxa de todos os bot√µes e coloca s√≥ no que foi clicado
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                botaoClicado.classList.add('active');

                // Atualiza o t√≠tulo
                document.getElementById('titulo-secao').innerText = categoriaSelecionada === 'Todos' ? 'Todos os Pratos' : categoriaSelecionada;

                // Filtra os dados
                let pratosFiltrados = lojaAtual.cardapio;
                if (categoriaSelecionada !== 'Todos') {
                    pratosFiltrados = lojaAtual.cardapio.filter(p => p.categoria === categoriaSelecionada);
                }
                
                // Desenha a tela novamente
                renderizarVitrine(pratosFiltrados);
            }

            // --- Fim da Nova L√≥gica ---

            // Motor que desenha a tela (agora virou uma fun√ß√£o reutiliz√°vel)
            function renderizarVitrine(itens) {
                const vitrine = document.getElementById('vitrine-produtos');
                vitrine.innerHTML = ''; // Limpa a tela antes de desenhar
                
                itens.forEach(prato => {
                    // Verifica se a imagem √© um link (img/...) ou um emoji provis√≥rio
                    const imagemHTML = prato.imagem.includes('/') 
                        ? `<img src="${prato.imagem}" alt="${prato.nome}">` 
                        : prato.imagem;

                    const cardHTML = `
                        <div class="product-card">
                            <div class="product-img">${imagemHTML}</div>
                            <div class="product-info">
                                <div>
                                    <h3 class="product-title">${prato.nome}</h3>
                                    <p class="product-desc">${prato.descricao}</p>
                                </div>
                                <div class="product-footer">
                                    <span class="product-price">${formatarMoeda(prato.preco)}</span>
                                    <button class="add-btn" onclick="adicionarItem('${prato.nome}', ${prato.preco}, this)">+</button>
                                </div>
                            </div>
                        </div>
                    `;
                    vitrine.innerHTML += cardHTML;
                });
            }

            // Roda pela primeira vez mostrando "Todos"
            renderizarVitrine(lojaAtual.cardapio);

        } else {
            document.body.innerHTML = "<h1 style='text-align:center; padding: 50px;'>Restaurante n√£o encontrado.</h1>";
        }

        // --- C√≥digo do Carrinho (Mantido igual) ---
        function adicionarItem(nome, preco, botao) {
            carrinho.push({ nome, preco });
            total += preco;
            document.getElementById('total-carrinho').innerText = formatarMoeda(total);
            document.getElementById('texto-carrinho').innerText = `üõí Fechar Pedido (${carrinho.length})`;

            botao.innerText = "‚úì";
            botao.style.backgroundColor = "var(--whatsapp-green)";
            botao.style.color = "white";
            setTimeout(() => {
                botao.innerText = "+";
                botao.style.backgroundColor = "var(--light-purple)";
                botao.style.color = "var(--primary-purple)";
            }, 800);
        }

        function fecharPedido() {
            if (carrinho.length === 0) {
                alert("Selecione algum item primeiro!"); return;
            }
            let msg = `Ol√°! Gostaria de fazer o seguinte pedido na ${lojaAtual.nome}:\n\n`;
            carrinho.forEach(item => { msg += `‚ñ´Ô∏è ${item.nome} - ${formatarMoeda(item.preco)}\n`; });
            msg += `\n*Total: ${formatarMoeda(total)}*\n\n`;
            msg += "üìç Endere√ßo para entrega:\nüí≥ Forma de pagamento:\n";
            const url = `https://wa.me/${lojaAtual.whatsapp}?text=${encodeURIComponent(msg)}`;
            window.open(url, '_blank');
        }
    </script>
</body>
</html>