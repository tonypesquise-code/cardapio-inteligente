<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card√°pio Inteligente</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-purple: #6200ea; 
            --text-dark: #1a1a1a;
            --text-light: #717171;
            --white: #ffffff;
            --background: #ffffff;
            --border-color: #f0f0f0;
            --whatsapp-green: #25d366;
            --ifood-gray: #f7f7f7; 
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        
        body { background-color: var(--background); color: var(--text-dark); padding-bottom: 90px; -webkit-font-smoothing: antialiased; }

        header {
            background: var(--white);
            padding: 24px 20px 16px; 
            border-bottom: 1px solid var(--border-color);
        }
        header h1 { font-size: 1.1rem; font-weight: 700; margin-bottom: 4px; color: var(--text-dark); }
        header p { font-size: 0.85rem; font-weight: 400; color: var(--text-light); }

        .container { max-width: 600px; margin: 0 auto; padding: 16px 20px; }
        
        .section-title { font-size: 1.05rem; font-weight: 700; margin-bottom: 12px; color: var(--text-dark); }

        /* --- BOT√ïES MAIS FINOS E COMPACTOS --- */
        .categories-container {
            display: grid;
            grid-template-rows: repeat(2, 1fr); 
            grid-auto-columns: calc(50% - 4px); /* Ajuste fino na largura */
            grid-auto-flow: column; 
            gap: 8px; /* Menos espa√ßo entre os bot√µes */
            overflow-x: auto; 
            padding-bottom: 8px; /* Menos espa√ßo embaixo da rolagem */
            margin-bottom: 12px; /* Puxa os pratos mais para cima */
            scrollbar-width: none; 
            scroll-snap-type: x mandatory; 
        }
        .categories-container::-webkit-scrollbar { display: none; } 
        
        .category-btn {
            scroll-snap-align: start; 
            background-color: var(--ifood-gray); 
            color: var(--text-dark);
            border: 2px solid transparent; 
            padding: 6px 8px; /* AQUI EST√Å A M√ÅGICA: Reduziu a altura drasticamente */
            border-radius: 10px; /* Borda um pouco mais fechada para acompanhar o novo formato */
            white-space: nowrap; 
            cursor: pointer; 
            font-weight: 500; 
            font-size: 0.85rem; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 6px; /* √çcone um pouquinho mais perto do texto */
            transition: all 0.2s ease;
            width: 100%; 
        }
        
        .category-icon {
            font-size: 1.1rem; /* √çcone levemente menor para caber no bot√£o fino */
            display: flex; align-items: center; justify-content: center;
        }

        .category-btn.active {
            background-color: #f5f0ff; 
            color: var(--primary-purple); 
            border-color: var(--primary-purple);
            font-weight: 600;
        }
        /* --------------------------------------------------------- */

        .product-card {
            background-color: var(--white); display: flex; align-items: stretch;
            margin-bottom: 0; padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
            animation: fadeInUp 0.4s ease backwards; 
        }
        .product-card:last-child { border-bottom: none; }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .product-img { 
            width: 85px; height: 85px; border-radius: 8px; overflow: hidden; 
            background-color: #f9f9f9; display: flex; align-items: center; justify-content: center; 
            flex-shrink: 0; margin-right: 16px;
        }
        .product-img img { width: 100%; height: 100%; object-fit: cover; }
        
        .product-info { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        
        .product-title { font-size: 0.95rem; font-weight: 600; color: var(--text-dark); margin-bottom: 4px; }
        .product-desc { font-size: 0.8rem; color: var(--text-light); line-height: 1.3; font-weight: 400; margin-bottom: 10px; }
        
        .product-footer { display: flex; justify-content: space-between; align-items: center; }
        .product-price { font-weight: 600; color: var(--text-dark); font-size: 0.95rem; }
        
        .qty-control { display: flex; align-items: center; gap: 8px; }
        .qty-btn {
            background-color: var(--white); color: var(--primary-purple); 
            border: 1px solid var(--border-color); width: 26px; height: 26px; border-radius: 4px; 
            font-size: 1rem; font-weight: 500; cursor: pointer; display: flex; 
            align-items: center; justify-content: center; transition: background 0.2s;
        }
        .qty-btn:active { background-color: #f5f0ff; border-color: var(--primary-purple); }
        .qty-display { font-weight: 500; color: var(--text-dark); width: 16px; text-align: center; font-size: 0.85rem; }

        .floating-cart { 
            position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); 
            width: calc(100% - 32px); max-width: 400px; background-color: var(--primary-purple); 
            color: var(--white); border: none; border-radius: 8px; padding: 14px 20px; 
            font-size: 0.95rem; font-weight: 600; display: flex; justify-content: space-between; 
            align-items: center; box-shadow: 0 4px 12px rgba(98, 0, 234, 0.2); 
            cursor: pointer; z-index: 1000; transition: transform 0.1s;
        }
        .floating-cart:active { transform: translateX(-50%) scale(0.98); }
    </style>
</head>
<body>

    <header>
        <h1 id="nome-loja">Carregando...</h1>
        <p id="slogan-loja"></p>
    </header>

    <div class="container">
        <div class="categories-container" id="filtros-categoria"></div>
        <h2 class="section-title" id="titulo-secao">Todos os Pratos</h2>
        <div id="vitrine-produtos"></div>
    </div>

    <button class="floating-cart" onclick="fecharPedido()">
        <span id="texto-carrinho">Sacola Vazia</span>
        <span id="total-carrinho">R$ 0,00</span>
    </button>

    <script src="dados.js"></script>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const lojaId = urlParams.get('loja') || 'cantina'; 
        const lojaAtual = restaurantes.find(r => r.id === lojaId);
        
        let carrinho = {}; 
        const formatarMoeda = (valor) => valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

        function obterIcone(categoria) {
            const icones = {
                "Todos": "üçΩÔ∏è",
                "Pizzas": "üçï",
                "Massas": "üçù",
                "Bebidas": "ü•§",
                "Hamb√∫rgueres": "üçî",
                "Sobremesas": "üç∞",
                "Por√ß√µes": "üçü"
            };
            return icones[categoria] || "üè∑Ô∏è"; 
        }

        if (lojaAtual) {
            document.getElementById('nome-loja').innerText = lojaAtual.nome;
            document.getElementById('slogan-loja').innerText = lojaAtual.slogan;

            const categoriasUnicas = ["Todos", ...new Set(lojaAtual.cardapio.map(prato => prato.categoria))];
            const containerFiltros = document.getElementById('filtros-categoria');

            categoriasUnicas.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'category-btn' + (cat === 'Todos' ? ' active' : '');
                
                const icone = obterIcone(cat);
                btn.innerHTML = `<span class="category-icon">${icone}</span><span>${cat}</span>`;
                
                btn.onclick = () => filtrarCardapio(cat, btn);
                containerFiltros.appendChild(btn);
            });

            function filtrarCardapio(categoriaSelecionada, botaoClicado) {
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                botaoClicado.classList.add('active');

                document.getElementById('titulo-secao').innerText = categoriaSelecionada === 'Todos' ? 'Todos os Pratos' : categoriaSelecionada;

                let pratosFiltrados = lojaAtual.cardapio;
                if (categoriaSelecionada !== 'Todos') {
                    pratosFiltrados = lojaAtual.cardapio.filter(p => p.categoria === categoriaSelecionada);
                }
                
                renderizarVitrine(pratosFiltrados);
            }

            function renderizarVitrine(itens) {
                const vitrine = document.getElementById('vitrine-produtos');
                vitrine.innerHTML = ''; 
                
                itens.forEach((prato, index) => {
                    const imagemHTML = prato.imagem.includes('/') 
                        ? `<img src="${prato.imagem}" alt="${prato.nome}">` 
                        : prato.imagem;

                    const qtdAtual = carrinho[prato.id] ? carrinho[prato.id].quantidade : 0;
                    const animDelay = index * 0.05;

                    const cardHTML = `
                        <div class="product-card" style="animation-delay: ${animDelay}s">
                            <div class="product-img">${imagemHTML}</div>
                            <div class="product-info">
                                <div>
                                    <h3 class="product-title">${prato.nome}</h3>
                                    <p class="product-desc">${prato.descricao}</p>
                                </div>
                                <div class="product-footer">
                                    <span class="product-price">${formatarMoeda(prato.preco)}</span>
                                    
                                    <div class="qty-control">
                                        <button class="qty-btn" onclick="alterarQuantidade(${prato.id}, -1)">-</button>
                                        <span class="qty-display" id="qty-${prato.id}">${qtdAtual}</span>
                                        <button class="qty-btn" onclick="alterarQuantidade(${prato.id}, 1)">+</button>
                                    </div>

                                </div>
                            </div>
                        </div>
                    `;
                    vitrine.innerHTML += cardHTML;
                });
            }

            renderizarVitrine(lojaAtual.cardapio);

        } else {
            document.body.innerHTML = "<div style='padding: 40px 20px; text-align: center;'><h2 style='font-size: 1.1rem; color: #1a1a1a;'>Restaurante n√£o encontrado.</h2></div>";
        }

        function alterarQuantidade(id, variacao) {
            if (!carrinho[id]) {
                if (variacao > 0) {
                    const prato = lojaAtual.cardapio.find(p => p.id === id);
                    carrinho[id] = { nome: prato.nome, preco: prato.preco, quantidade: 1 };
                }
            } else {
                carrinho[id].quantidade += variacao;
                if (carrinho[id].quantidade <= 0) {
                    delete carrinho[id];
                }
            }

            const visorQtd = document.getElementById(`qty-${id}`);
            if (visorQtd) {
                visorQtd.innerText = carrinho[id] ? carrinho[id].quantidade : 0;
            }

            atualizarCarrinhoUI();
        }

        function atualizarCarrinhoUI() {
            let total = 0;
            let totalItens = 0;

            for (let id in carrinho) {
                total += carrinho[id].preco * carrinho[id].quantidade;
                totalItens += carrinho[id].quantidade;
            }

            document.getElementById('total-carrinho').innerText = formatarMoeda(total);
            document.getElementById('texto-carrinho').innerText = totalItens > 0 ? `Ver Sacola (${totalItens})` : `Sacola Vazia`;
        }

        function fecharPedido() {
            if (Object.keys(carrinho).length === 0) {
                alert("Selecione algum item primeiro!"); return;
            }

            let msg = `Ol√°! Gostaria de fazer o seguinte pedido na ${lojaAtual.nome}:\n\n`;
            let totalPedido = 0;

            for (let id in carrinho) {
                const item = carrinho[id];
                const subtotalItem = item.preco * item.quantidade;
                totalPedido += subtotalItem;
                msg += `‚ñ´Ô∏è ${item.quantidade}x ${item.nome} - ${formatarMoeda(subtotalItem)}\n`;
            }

            msg += `\n*Total: ${formatarMoeda(totalPedido)}*\n\n`;
            msg += "üìç Endere√ßo para entrega:\nüí≥ Forma de pagamento:\n";
            
            const url = `https://wa.me/${lojaAtual.whatsapp}?text=${encodeURIComponent(msg)}`;
            window.open(url, '_blank');
        }
    </script>
</body>
</html>