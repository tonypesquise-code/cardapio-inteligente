<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mangiare | Portal de Acesso</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Identidade Visual Mangiare */
            --primary: #DC0B1C; /* Vermelho */
            --primary-hover: #b50917;
            --secondary: #00A944; /* Verde */
            --secondary-hover: #008f39;
            
            --bg-color: #f4f5f7;
            --text-dark: #1f2937;
            --text-muted: #6b7280;
            --border: #e5e7eb;
            --error: #dc2626;
            --success: #10b981;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }

        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            color: var(--text-dark);
        }

        .auth-container {
            background: white;
            width: 100%;
            max-width: 450px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            overflow: hidden;
            margin: 20px;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-header {
            background: var(--primary);
            padding: 40px 20px 30px;
            text-align: center;
            color: white;
        }
        
        .auth-header img {
            height: 55px; /* Altura ideal para a logo */
            width: auto;
            object-fit: contain;
            margin-bottom: 5px;
        }

        .auth-header p {
            font-size: 0.85rem; 
            opacity: 0.9; 
            margin-top: 5px; 
            font-weight: 500;
        }

        .auth-tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid var(--border);
        }

        .tab-btn {
            flex: 1;
            padding: 16px;
            text-align: center;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            transition: 0.3s;
            border-bottom: 3px solid transparent;
            font-size: 1.05rem;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .auth-body { padding: 30px; }

        .form-section { display: none; }
        .form-section.active { display: block; animation: fadeIn 0.3s ease; }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .form-group { margin-bottom: 18px; }
        .form-label { display: block; font-size: 0.85rem; font-weight: 700; margin-bottom: 8px; color: var(--text-dark); }
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.95rem;
            outline: none;
            transition: 0.2s;
            background: white;
        }
        .form-control:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(220, 11, 28, 0.1); }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        .role-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: #f8fafc;
            padding: 6px;
            border-radius: 10px;
        }

        .role-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            border-radius: 8px;
            transition: 0.2s;
            color: var(--text-muted);
            border: 1px solid transparent;
        }

        .role-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            border-color: #e5e7eb;
        }

        .btn-submit {
            width: 100%;
            padding: 16px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
            transition: 0.2s;
        }
        .btn-submit:hover { background: var(--secondary-hover); }
        .btn-submit:disabled { opacity: 0.7; cursor: not-allowed; }

        .msg-error {
            color: var(--error);
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
            display: none;
            background: #fef2f2;
            padding: 10px;
            border-radius: 6px;
        }
        
        .msg-success {
            color: var(--success);
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
            display: none;
            background: #dcfce7;
            padding: 10px;
            border-radius: 6px;
        }

        @media (max-width: 600px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            .auth-body { 
                padding: 20px; 
            }
        }
    </style>
</head>
<body>

    <div class="auth-container">
        <div class="auth-header">
            
            <img src="img/logo_mangiareb.svg" alt="Logo Mangiare">
            
            <p>Gest√£o de Delivery Inteligente</p>
        </div>

        <div class="auth-tabs">
            <div class="tab-btn active" onclick="switchTab('login')">Entrar</div>
            <div class="tab-btn" onclick="switchTab('register')">Criar Conta</div>
        </div>

        <div class="auth-body">
            
            <div id="msg-error" class="msg-error"></div>
            <div id="msg-success" class="msg-success"></div>

            <div id="section-login" class="form-section active">
                <form id="form-login">
                    <div class="form-group">
                        <label class="form-label">E-mail</label>
                        <input type="email" id="login-email" class="form-control" placeholder="seu@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Senha</label>
                        <input type="password" id="login-senha" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <div style="text-align: right; margin-bottom: 20px;">
                        <a href="#" style="font-size: 0.85rem; color: var(--primary); text-decoration: none; font-weight: 600;">Esqueceu a senha?</a>
                    </div>
                    <button type="submit" class="btn-submit" id="btn-do-login">Entrar no Sistema</button>
                </form>
            </div>

            <div id="section-register" class="form-section">
                
                <div class="role-selector">
                    <div class="role-btn active" id="role-loja" onclick="switchRole('loja')">üè™ Estabelecimento</div>
                    <div class="role-btn" id="role-motoboy" onclick="switchRole('motoboy')">üõµ Entregador</div>
                </div>

                <form id="form-register">
                    
                    <div id="fields-loja">
                        <div class="form-group">
                            <label class="form-label">Nome da Empresa</label>
                            <input type="text" id="reg-empresa" class="form-control" placeholder="Ex: Pizzaria Mangiare">
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label class="form-label">CNPJ</label>
                                <input type="text" id="reg-cnpj" class="form-control" placeholder="00.000.000/0001-00">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nome do Gestor</label>
                                <input type="text" id="reg-admin" class="form-control" placeholder="Seu nome">
                            </div>
                        </div>
                    </div>

                    <div id="fields-motoboy" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Nome Completo</label>
                            <input type="text" id="reg-nome-motoboy" class="form-control" placeholder="Ex: Jo√£o da Silva">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Placa da Moto</label>
                            <input type="text" id="reg-placa" class="form-control" placeholder="ABC-1234" style="text-transform: uppercase;">
                        </div>
                    </div>

                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">WhatsApp</label>
                            <input type="tel" id="reg-whatsapp" class="form-control" placeholder="(00) 90000-0000" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">E-mail de Acesso</label>
                            <input type="email" id="reg-email" class="form-control" placeholder="seu@email.com" required>
                        </div>
                    </div>

                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Crie uma Senha</label>
                            <input type="password" id="reg-senha" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Repita a Senha</label>
                            <input type="password" id="reg-senha-conf" class="form-control" placeholder="Confirme a senha" required minlength="6">
                        </div>
                    </div>

                    <button type="submit" class="btn-submit" id="btn-do-register">Criar Conta Gr√°tis</button>
                </form>
            </div>

        </div>
    </div>

    <script>
        let currentRole = 'loja';

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.form-section').forEach(sec => sec.classList.remove('active'));
            
            if(tab === 'login') {
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
                document.getElementById('section-login').classList.add('active');
            } else {
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                document.getElementById('section-register').classList.add('active');
            }
            ocultarMensagens();
        }

        function switchRole(role) {
            currentRole = role;
            document.getElementById('role-loja').classList.remove('active');
            document.getElementById('role-motoboy').classList.remove('active');
            document.getElementById('fields-loja').style.display = 'none';
            document.getElementById('fields-motoboy').style.display = 'none';

            if(role === 'loja') {
                document.getElementById('role-loja').classList.add('active');
                document.getElementById('fields-loja').style.display = 'block';
                document.getElementById('reg-empresa').required = true;
                document.getElementById('reg-cnpj').required = true;
                document.getElementById('reg-nome-motoboy').required = false;
            } else {
                document.getElementById('role-motoboy').classList.add('active');
                document.getElementById('fields-motoboy').style.display = 'block';
                document.getElementById('reg-empresa').required = false;
                document.getElementById('reg-cnpj').required = false;
                document.getElementById('reg-nome-motoboy').required = true;
            }
        }

        function mostrarErro(msg) {
            const div = document.getElementById('msg-error');
            div.innerText = msg; div.style.display = 'block';
            document.getElementById('msg-success').style.display = 'none';
        }

        function mostrarSucesso(msg) {
            const div = document.getElementById('msg-success');
            div.innerText = msg; div.style.display = 'block';
            document.getElementById('msg-error').style.display = 'none';
        }

        function ocultarMensagens() {
            document.getElementById('msg-error').style.display = 'none';
            document.getElementById('msg-success').style.display = 'none';
        }
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAB8wxPDhBhiX39dye_KvdapHUsDspbLsk",
            authDomain: "mangiare-79f67.firebaseapp.com",
            projectId: "mangiare-79f67",
            storageBucket: "mangiare-79f67.firebasestorage.app",
            messagingSenderId: "942988586703",
            appId: "1:942988586703:web:b0a1ac8f0a9532e74e91ba"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- SISTEMA DE CADASTRO ---
        document.getElementById('form-register').addEventListener('submit', async (e) => {
            e.preventDefault();
            ocultarMensagens();

            const senha = document.getElementById('reg-senha').value;
            const senhaConf = document.getElementById('reg-senha-conf').value;

            if (senha !== senhaConf) {
                mostrarErro("‚ùå As senhas n√£o s√£o iguais. Digite novamente.");
                return;
            }

            const email = document.getElementById('reg-email').value;
            const wpp = document.getElementById('reg-whatsapp').value;
            const btn = document.getElementById('btn-do-register');
            
            btn.innerText = "Criando conta... ‚è≥";
            btn.disabled = true;

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
                const user = userCredential.user;

                let dadosUsuario = {
                    uid: user.uid,
                    email: email,
                    whatsapp: wpp,
                    tipoConta: currentRole, 
                    dataCadastro: serverTimestamp(),
                    status: 'ativo'
                };

                if (currentRole === 'loja') {
                    dadosUsuario.nomeEmpresa = document.getElementById('reg-empresa').value;
                    dadosUsuario.cnpj = document.getElementById('reg-cnpj').value;
                    dadosUsuario.nomeAdmin = document.getElementById('reg-admin').value;
                } else {
                    dadosUsuario.nomeCompleto = document.getElementById('reg-nome-motoboy').value;
                    dadosUsuario.placaMoto = document.getElementById('reg-placa').value;
                }

                await setDoc(doc(db, "usuarios", user.uid), dadosUsuario);

                mostrarSucesso("üéâ Conta criada com sucesso! Redirecionando...");
                
                setTimeout(() => {
                    if(currentRole === 'loja') window.location.href = 'gestor.html';
                    else window.location.href = 'motoboy.html';
                }, 1500);

            } catch (error) {
                console.error(error);
                btn.innerText = "Criar Conta Gr√°tis";
                btn.disabled = false;
                
                if (error.code === 'auth/email-already-in-use') {
                    mostrarErro("‚ùå Este e-mail j√° est√° cadastrado.");
                } else if (error.code === 'auth/weak-password') {
                    mostrarErro("‚ùå A senha √© muito fraca.");
                } else {
                    mostrarErro("‚ùå Ocorreu um erro ao criar a conta.");
                }
            }
        });

        // --- SISTEMA DE LOGIN ---
        document.getElementById('form-login').addEventListener('submit', async (e) => {
            e.preventDefault();
            ocultarMensagens();

            const email = document.getElementById('login-email').value;
            const senha = document.getElementById('login-senha').value;
            const btn = document.getElementById('btn-do-login');

            btn.innerText = "Autenticando... ‚è≥";
            btn.disabled = true;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, senha);
                const user = userCredential.user;

                const docSnap = await getDoc(doc(db, "usuarios", user.uid));

                if (docSnap.exists()) {
                    const userData = docSnap.data();
                    
                    mostrarSucesso("‚úÖ Acesso concedido!");

                    setTimeout(() => {
                        if(userData.tipoConta === 'loja') {
                            window.location.href = 'gestor.html';
                        } else if (userData.tipoConta === 'motoboy') {
                            window.location.href = 'motoboy.html';
                        }
                    }, 1000);

                } else {
                    mostrarErro("‚ùå Dados de perfil n√£o encontrados.");
                    btn.innerText = "Entrar no Sistema";
                    btn.disabled = false;
                }

            } catch (error) {
                console.error(error);
                btn.innerText = "Entrar no Sistema";
                btn.disabled = false;
                
                if(error.code === 'auth/invalid-credential' || error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                    mostrarErro("‚ùå E-mail ou senha incorretos.");
                } else {
                    mostrarErro("‚ùå Erro ao tentar fazer login.");
                }
            }
        });

    </script>
</body>
</html>